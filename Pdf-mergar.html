<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Merge PDF Online â€“ PDFWala.in</title>

<meta name="description" content="Merge PDF files online with reorder and preview before download. Free browser merge and premium server merge. PDFWala.in">
<meta name="keywords" content="merge pdf, combine pdf, reorder pdf, pdf merger online, pdfwala">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PDF-lib for browser merge -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
:root{
  --brand:#e53935;
  --bg:#f3f4f6;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#111827;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto}

body{margin:0;background:var(--bg);color:var(--text);}

header{background:#fff;border-bottom:1px solid var(--border);}
.header{max-width:1100px;margin:auto;padding:12px 16px;}
.logo{color:var(--brand);text-decoration:none;font-weight:700;font-size:20px;}

.container{max-width:820px;margin:32px auto;padding:0 16px;}
.card{background:#fff;border-radius:14px;padding:22px;box-shadow:0 8px 20px rgba(0,0,0,.06);}

h1{margin-top:0;font-size:24px}

.drop{border:2px dashed #d1d5db;border-radius:12px;padding:28px 18px;text-align:center;cursor:pointer;transition:.2s;}
.drop.drag{border-color:var(--brand);background:#fff5f5;}
input[type=file]{display:none}

.list{margin-top:14px;display:flex;flex-direction:column;gap:8px}
.item{border:1px solid var(--border);padding:10px 12px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;background:#fff;cursor:grab;font-size:14px}

.actions{margin-top:16px}
button{padding:12px 18px;border:none;border-radius:10px;background:var(--brand);color:#fff;font-weight:600;cursor:pointer}

.status{margin-top:10px;font-size:14px;color:#374151}

/* preview */
.previewBox{margin-top:18px;display:none}
.previewBox h3{margin:0 0 8px 0;font-size:16px}
.previewFrame{width:100%;height:420px;border:1px solid var(--border);border-radius:8px;background:#fff}
.downloadBtn{margin-top:10px;background:#111827}

.note{margin-top:10px;font-size:12px;color:#6b7280}
</style>
</head>
<body>

<header>
  <div class="header">
    <!-- Always show your full domain and link to home -->
    <a class="logo" href="https://pdfwala.in">PDFWala.in</a>
  </div>
</header>

<div class="container">
  <div class="card">

    <h1>Merge PDF</h1>
    <p>Upload PDFs, drag to change order, merge and preview before downloading.</p>

    <div class="drop" id="dropBox">
      <strong>Drop your PDF files here</strong><br>
      or click to upload
      <input id="fileInput" type="file" multiple accept="application/pdf">
    </div>

    <div class="list" id="fileList"></div>

    <div class="actions">
      <button id="mergeBtn">Merge PDF</button>
    </div>

    <div class="status" id="status"></div>

    <!-- Preview + Download -->
    <div class="previewBox" id="previewBox">
      <h3>Preview your merged PDF</h3>
      <iframe id="previewFrame" class="previewFrame"></iframe>
      <button id="downloadBtn" class="downloadBtn">Download PDF</button>
    </div>

    <div class="note">
      Drag files up or down to change order before merging.
    </div>

  </div>
</div>

<script>
/* =======================================================
   Premium / Free is decided on HOME PAGE only.
   Here we only read it.
======================================================= */
const isPremiumUser = localStorage.getItem("plan") === "premium";

/* Backend endpoint (used only if premium) */
const BACKEND_URL = "https://YOUR_BACKEND_DOMAIN/merge";

/* State */
let pdfFiles = [];
let dragIndex = null;
let finalBlobURL = null;

/* UI refs */
const dropBox      = document.getElementById("dropBox");
const fileInput    = document.getElementById("fileInput");
const fileList     = document.getElementById("fileList");
const statusBox    = document.getElementById("status");
const mergeBtn     = document.getElementById("mergeBtn");
const previewBox   = document.getElementById("previewBox");
const previewFrame = document.getElementById("previewFrame");
const downloadBtn  = document.getElementById("downloadBtn");

/* ---------- Upload ---------- */
dropBox.onclick = () => fileInput.click();

dropBox.addEventListener("dragover", e=>{
  e.preventDefault();
  dropBox.classList.add("drag");
});
dropBox.addEventListener("dragleave", ()=>{
  dropBox.classList.remove("drag");
});
dropBox.addEventListener("drop", e=>{
  e.preventDefault();
  dropBox.classList.remove("drag");
  addFiles(e.dataTransfer.files);
});
fileInput.addEventListener("change", ()=>{
  addFiles(fileInput.files);
});

/* ---------- File handling ---------- */
function addFiles(files){
  for(const f of files){
    if(f.type === "application/pdf"){
      pdfFiles.push(f);
    }
  }
  renderList();
}

function renderList(){
  fileList.innerHTML = "";
  pdfFiles.forEach((file,index)=>{
    const item = document.createElement("div");
    item.className = "item";
    item.draggable = true;
    item.dataset.index = index;
    item.innerHTML = `<span>${file.name}</span><small>Drag</small>`;
    addDragEvents(item);
    fileList.appendChild(item);
  });
}

/* ---------- Drag reorder ---------- */
function addDragEvents(el){
  el.addEventListener("dragstart", ()=>{
    dragIndex = +el.dataset.index;
  });
  el.addEventListener("dragover", e=>e.preventDefault());
  el.addEventListener("drop", e=>{
    e.preventDefault();
    const targetIndex = +el.dataset.index;
    moveItem(dragIndex, targetIndex);
  });
}

function moveItem(from, to){
  if(from === to || from == null) return;
  const item = pdfFiles.splice(from,1)[0];
  pdfFiles.splice(to,0,item);
  renderList();
}

/* ---------- Merge ---------- */
mergeBtn.addEventListener("click", mergeHandler);

async function mergeHandler(){
  if(!pdfFiles.length){
    alert("Please upload PDF files");
    return;
  }

  statusBox.textContent = isPremiumUser ?
    "Merging using server (premium)..." :
    "Merging in your browser...";

  previewBox.style.display = "none";
  previewFrame.src = "";
  finalBlobURL = null;

  try{
    if(isPremiumUser){
      await mergeBackend();
    }else{
      await mergeFrontend();
    }
    statusBox.textContent = "Your merged PDF is ready. Preview below.";
  }catch(err){
    console.error(err);
    statusBox.textContent = "Failed to merge PDF.";
  }
}

/* ---------- FREE (frontend) ---------- */
async function mergeFrontend(){
  const mergedPdf = await PDFLib.PDFDocument.create();
  for(const file of pdfFiles){
    const buf = await file.arrayBuffer();
    const pdf = await PDFLib.PDFDocument.load(buf);
    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
    pages.forEach(p=>mergedPdf.addPage(p));
  }
  const bytes = await mergedPdf.save();
  const blob = new Blob([bytes],{type:"application/pdf"});
  showPreview(blob);
}

/* ---------- PREMIUM (backend) ---------- */
async function mergeBackend(){
  const fd = new FormData();
  pdfFiles.forEach(f=>fd.append("files",f));

  const res = await fetch(BACKEND_URL,{ method:"POST", body:fd });
  if(!res.ok) throw new Error("Backend merge failed");

  const blob = await res.blob();
  showPreview(blob);
}

/* ---------- Preview & Download ---------- */
function showPreview(blob){
  finalBlobURL = URL.createObjectURL(blob);
  previewFrame.src = finalBlobURL;
  previewBox.style.display = "block";
}

/* File name: PDFWala.in + tool name + timestamp */
function buildFileName(toolName){
  const d = new Date();
  const pad = n => String(n).padStart(2,"0");
  const stamp =
    d.getFullYear() +
    pad(d.getMonth()+1) +
    pad(d.getDate()) + "-" +
    pad(d.getHours()) +
    pad(d.getMinutes()) +
    pad(d.getSeconds());
  return `PDFWala.in-${toolName}-${stamp}.pdf`;
}

downloadBtn.addEventListener("click", ()=>{
  if(!finalBlobURL) return;
  const a = document.createElement("a");
  a.href = finalBlobURL;
  a.download = buildFileName("merge");
  document.body.appendChild(a);
  a.click();
  a.remove();
});
</script>

</body>
</html>
